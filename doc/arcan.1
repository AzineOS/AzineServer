.\" groff -man -Tascii arcan.1
.TH arcan 1 "August 2014" arcan "User manual"
.SH NAME
Arcan \- Scriptable Multimedia Engine
.SH SYNOPSIS
.B arcan
.RI [ OPTIONS ]
.B applname
.RI [ APPLARGS ]

.SH DESCRIPTION
Arcan is a portable and fast self-sufficient multimedia engine for
advanced visualization and analysis work in a wide range of applications
e.g. game development, real-time streaming video, monitoring and
surveillance, up to and including desktop compositors and window managers.

.SH OPTIONS
.IP "\fB-h, --help\fR"
Show a brief summary of commands and usage.

.IP "\fB-W, --sync-strat\fR \fIstrategy\fR"
Specify the synchronization strategy that the display driver should use.
These are dependent on the built-time configuration of the engine and are
listed at the end of running arcan with the --help command-line argument.

.IP "\fB-M, --monitor\fR \fIrate\fR"
Enable monitoring mode, every \fIrate\fR ticks, save a snapshot of the scripting
 engine state to a monitoring target (see -O, --monitor-out).

.IP "\fB-O, --monitor-out \fItarget\fR"
Defines the monitoring data recipient, used in combination with -M, --monitor.
Either specify LOG:filename for a text-based recipient or a valid \fIappl\fR for
launching two arcan sessions where the monitoring snapshots are forwarded to
the other instance for analysis and visualization.

.IP "\fB-q, --timedump \fIticks\fR"
After \fIticks\fR logical pulses, generate a snapshot similar to -M, --monitor
and store in LOGPATH namespace as \fItimedump\fR. This is triggered only once.

.IP "\fB-m, --conservative\fR"
Toggle conservative memory management profile. The engine will store just
enough metadata to be able to reconstruct static data sources (e.g. most
textures, fonts etc.) should the display context need to be rebuilt.

.IP "\fB-p, --rpath \fIpath\fR"
Change default searchpath for shared resources, see the \fInamespaces\fR
section below for additional details.

.IP "\fB-t, --applpath \fIpath\fR"
Change default searchpath for applications, see the \fInamespaces\fR
section below for additional details.

.IP "\fB-b, --fallback \fIapplname\fR"
If the running application crashes due to scripting error or from misuse
of the API, all running external, \fIframeserver\fR, connections will be
transferred to \fIapplname\fR.

.IP "\fB-d, --database \fIdbname\fR"
Specify a different database for use when launching external targets and
as a key/value store for the running application.

.IP "\fB-g, --debug\fR"
Increases debuglevel, more troubleshooting data will be sent to the standard
error and standard output nodes. The active debuglevel is also exposed to
scripts. This can be added multiple times for additional effect.

.IP "\fB Unstable Arguments\fR"
These are slated to be replaced with a more flexible display configuration
system and will be changed in coming versions. Users should therefore take
precautions to make sure to notice when upgrading as not to break scripts
that depend on these features.

.IP "\fB-S, --nosound\fR"
Disable (silence) audio output.

.IP "\fB-s, --windowed\fR"
Set borderless, windowed display mode.

.IP "\fB-w, --width\fR \fIpixels\fR"
Set the desired active canvas width. Setting this value to zero will let
the display driver chose based on connected displays.

.IP "\fB-h, --height\fR \fIpixels\fR"
Set the desired active canvas height. Setting this value to zero will let
the display driver chose based on connected displays.

.IP "\fB-a, --multisamples\fR \fIsamples\fR"
Enable multisampling (MSAA), default: 4 samples. If MSAA setup fails,
the engine will silently revert to regular sampling.

.IP "\fB-f, --fullscreen\fR"
Fullscreen switch, the display driver will attempt to force the connected
display resolution to match the specified canvas dimensions.

.SH NAMESPACES
There is a large assortment of namespaces that the engine will search for
when a script requests access to- or the creation- of a resource. The two
larger ones are \fBARCAN_APPLPATH\fR and \fBARCAN_RESOURCEPATH\fR. These
can also be altered through the command-line arguments \fB-t\fR and \fB-p\fR.

Scripts can manipulate (create, open, read, write) the files within
the confines of the \fBAPPLPATH\fR. Traversal (../) outside this path will
be filtered, but a user can explicitly map (symlink, bind-mounts or similar)
other paths into this namespace and the engine will allow it.

Scripts gets read- access to resources within the \fBRESOURCEPATH\fR and
can explicitly request to search either or both namespaces when opening
a resource. By default, a namespace collision (the same resource existing
in multiple namespaces) gives priority to \fBAPPLPATH\fR.

Other namespaces are initially defined relative to the \fBRESOURCEPATH\fR,
and to a few known system locations (e.g. /usr/bin) but can be overridden
by setting the environment variables using the prefix
ARCAN_ the name of the namespace and suffixed by PATH, e.g. ARCAN_BINPATH.

The currently supported namespaces and their uses are as follows:

.IP "\fBSTATE\fR"
Used for calls to snapshot_target, and similar functions and is intended
for external target savestates. A savestate is treated as a binary blob
that can be used to store and restore the current state of an external
target.

.IP "\fBBIN\fR"
Used when looking for \fBframeservers\fR (see the FRAMESERVERS section
below for more detail), these are prefixed with arcan_frameserver and,
depending on build configuration, _mode where mode represents the role
and function of the specific frameserver.

.IP "\fBLIB\fR"
Used when looking for hijack libraries. These are libraries that are
preloaded or otherwise injected into specific process in order to
infiltrate/exfiltrate/manipulate data and flow of execution within the
process. The most common use for this is to alter render/audio and input
paths in non-compliant applications. These are used in conjunction with
entries in the database.

.IP "\fBFONT\fR"
Set to RESOURCEPATH/fonts by default, but can be redirected to another
shared font store.

.IP "\fBLOG\fR"
Set to RESOURCEPATH/logs by default (if it exists) and is used for storing
debugging, profiling and similar development/troubleshooting related data.
This includes state dumps which may contain sensitive data.

.SH FRAMESERVERS
A principal design decision behind Arcan is to split tasks that are
inherently prone to security and stability issues into separate processes
that should be sandboxed to as large a degree as possible with the
principle of least privilege in mind. It should be the active application
(set of user-supplied scripts) that dynamically control the level of
privilege, communication and data storage that such processes have access
to. Processes under such control are referred to as \fIFrameservers\fR to
which there are several archetypes defined. These are as follows:

.IP "\fBNET\fR"
Can be started in either client or server mode and implements a basic
communication, identification and discovery protocol.

.IP "\fBDECODE\fR"
Is used to decode audio/video feeds (a media player) with the usual
selection of features, ranging from capture devices to subtitled movies.

.IP "\fBRECORD\fR"
Is used to implement audio/video recording or streaming, but also for
related applications that depend on receiving data from the main process.
One such related application is that of remote control (e.g. a VNC/RDP server).

.IP "\fBREMOTING\fR"
This archetype is similar to \fIdecode\fR but prioritizes interactivity
and dynamic change in regards to user input. The default implementation uses
VNC/RDP and as such requires network access.

.IP "\fBLIBRETRO\fR"
This archetype represents gaming and the default implementation uses the
libretro interface (which provides games and emulators in the form of
dynamically loadable shared libraries, cores) which has the characteristics
of a high throughput, low-latency, timing sensitive and interactive data source.

.IP "\fBAVFEED\fR"
This archetype is not typically enabled, but is reserved for assisting the
development of generic Audio and/or Video sources.

.IP "\fBTERMINAL\fR"
Used to provide a terminal, a primarily text oriented interface that can
be bound to a shell or pipes and perform primitive translation, rendering
etc.

For more detailed information on the default implementations of these
archetypes, please refer to the individual manpages as referred to in the
\fISee Also\fR section at the end of this manpage.

All frameservers interact with the main arcan process through the use of
a (BSD licensed) shared memory interface which provides IPC primitives e.g.
event queues and dynamically resizeable buffers for audio and video transfers.

There are two ways frameservers can be activated, authoritative and
non-authoritative (or external).

Authoritative frameservers are spawned by the main arcan process and has
access handles etc. already mapped into the process at launch. These are
sandboxed through the use of a privileged chain-loader that prepares
file-system namespace, activity monitoring and system call filtering.

Non-authoritative frameservers connect through one (or two) environment
variables, ARCAN_CONNPATH and ARCAN_CONNKEY. These need to be explicitly
allocated and activated by the running application for each connection,
see target_alloc in the scripting API for more details.

From a user perspective, this mode can be considered similar to how a
desktop application would connect to an X server through the DISPLAY
environment variable.

.SH LIGHTWEIGHT (LWA) ARCAN

Lightweight arcan is a specialized build of the engine that uses the
frameserver shared memory API as a audio/video display backend. This allows
Arcan to run and control additional instances of itself, with the same or
a different application, thus reusing the engine to fulfill the role of
application framework, rendering engine, display server etc.

The lightweight application works just the same (although likely with
fewer dependencies on external libraries) as the main version, except
the ARCAN_CONNPATH mechanism need to be specified.

.SH DIAGNOSTICS
There are a number of ways the engine can shut down, especially if the engine
was built in Debug mode. A governing principle for user supplied scripts is
that of \fIFail Often, Early and Hard\fR. This means that API misuse,
i.e. missing or wrong arguments will result in a crash and the related error
description will be provided (color-coded) to the standard output, and that
a state dump will be generated and stored in the ARCAN_LOGPATH.

This state dump is a Lua parsable script that can be loaded either by a
monitoring script (similar to monitoring mode) or a regular Lua interpreter.

The environment variable \fBARCAN_FRAMESERVER_DEBUGSTALL\fR can be set if you
suspect that a frameserver is involved, or to blame, for an issue. This will
print the process ID (pid) of the new frameserver process to standard output,
then sleep for 10 seconds, giving ample room for you to attach a debugger or
tracing tool.

.SH HOMEPAGE
https://arcan-fe.com

.SH SEE-ALSO
.IX Header "SEE ALSO"
\&\fIarcan_api_overview\fR\|(3) \&\fIarcan_lwa\fR\|(3) \&\fIarcan_frameserver\fR\|(3)
\&\fIarcan_frameserver_libretro\fR\|(3) \&\fIarcan_frameserver_decode\fR\|(3)
\&\fIarcan_frameserver_encode\fR\|(3) \&\fIarcan_frameserver_remoting\fR\|(3)
\&\fIarcan_frameserver_net\fR\|(3) \&\fIarcan_frameserver_terminal\fR\|(3)

.SH BUGS
You can report bugs at the forum on the homepage or through the the AUTHOR
contact below. Save a snapshot of core-dumps (in the case of engine issues) or
the appropriate resources/logs entries. For some issues, a copy of the database
used and a list of files (with permissions) in themepath and
resourcepath might also be relevant.

.SH COPYRIGHT
Copyright  ©  2003-2014  Bjorn Stahl. License GPLv3+: GNU GPL version 3 or
later <http://gnu.org/licenses/gpl.html>. This is free software: you are
free  to  change  and  redistribute  it. There is NO WARRANTY,
to the extent permitted by law.

.SH AUTHOR
Bjorn Stahl <contact at arcan-fe dot com>
